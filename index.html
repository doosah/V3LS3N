<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Сводные данные | Система учёта</title>
    
    <!-- CSS Modules -->
    <link rel="stylesheet" href="src/css/variables.css">
    <link rel="stylesheet" href="src/css/brand.css">
    <link rel="stylesheet" href="src/css/base.css">
    <link rel="stylesheet" href="src/css/layout.css">
    <link rel="stylesheet" href="src/css/components.css">
    <link rel="stylesheet" href="src/css/theme.css">
    <link rel="stylesheet" href="src/css/tables.css">
    <link rel="stylesheet" href="src/css/logos.css">
    <link rel="stylesheet" href="src/css/date-navigation.css">
    <link rel="stylesheet" href="src/css/icons.css">
    <link rel="stylesheet" href="src/css/responsive.css">
    <link rel="stylesheet" href="src/css/update-badge.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-inner">
                <img src="img/logowhite.png" alt="V3LS3N Logo" class="logo-fixed-header">
                <div class="header-text">
                    <div class="subtitle subtitle-right">Сервис учета и аналитики доставки хабов</div>
                </div>
            </div>
        </div>

        <div id="mainSection" class="section active">
            <h2>Выберите отчёт</h2>
            <button class="large-button" onclick="selectReport('operational')">📄 Операционные показатели</button>
            <button class="large-button" onclick="selectReport('personnel')">📄 Персонал</button>
            <button class="large-button" onclick="showExportSection()">📊 Экспорт Excel</button>
            <div class="main-logo-wrapper">
                <img src="img/logo1.png" alt="Main Logo" class="main-page-logo">
            </div>
        </div>

        <div id="warehouseReportSection" class="section">
            <h2 id="warehouseTitle">Отчёт по складу</h2>
            <div class="warehouse-list" id="warehouseList"></div>
            <div class="action-buttons" style="margin-top: 20px;">
                <button class="secondary large-button" onclick="showSummarySection()">📋 Сводная таблица</button>
                <button class="secondary" onclick="backToMain()">← Назад к выбору отчёта</button>
            </div>
            <div class="date-section hidden">
                <h3>📅 Выберите дату</h3>
                <div class="calendar-controls">
                    <button class="secondary" onclick="prevPeriod()">← Предыдущий</button>
                    <button class="secondary" onclick="toggleCalendarView()">
                        <span id="warehouseViewToggleText">📅 Неделя</span>
                    </button>
                    <button class="secondary" onclick="nextPeriod()">Следующий →</button>
                </div>
                <div id="warehouseCalendar" class="calendar"></div>
                <div id="selectedWarehouseDate" class="selected-date-display"></div>
            </div>
            <div class="radio-group hidden">
                <label><input type="radio" name="warehouseReportType" value="day" checked> ☀️ Дневная смена</label>
                <label><input type="radio" name="warehouseReportType" value="night"> 🌙 Ночная смена</label>
            </div>
            <form id="reportForm" class="hidden">
                <div id="categoryInputs"></div>
                <div class="action-buttons">
                    <button type="button" onclick="saveWarehouseReport()">💾 Сохранить отчёт</button>
                    <button class="secondary" onclick="backToMain()">← Назад к выбору отчёта</button>
                </div>
            </form>
        </div>

        <div id="personnelReportSection" class="section">
            <h2 id="personnelTitle">Отчёт по персоналу</h2>
            <div class="warehouse-list" id="personnelList"></div>
            <div class="action-buttons" style="margin-top: 20px;">
                <button class="secondary large-button" onclick="showPersonnelSummarySection()">📋 Сводная таблица</button>
                <button class="secondary" onclick="backToMain()">← Назад к выбору отчёта</button>
            </div>
            <div class="date-section hidden">
                <h3>📅 Выберите дату</h3>
                <div class="calendar-controls">
                    <button class="secondary" onclick="prevPeriodPersonnel()">← Предыдущий</button>
                    <button class="secondary" onclick="toggleCalendarViewPersonnel()">
                        <span id="personnelViewToggleText">📅 Неделя</span>
                    </button>
                    <button class="secondary" onclick="nextPeriodPersonnel()">Следующий →</button>
                </div>
                <div id="personnelCalendar" class="calendar"></div>
                <div id="selectedPersonnelDate" class="selected-date-display"></div>
            </div>
            <div class="radio-group hidden">
                <label><input type="radio" name="personnelReportType" value="day" checked> ☀️ Дневная смена</label>
                <label><input type="radio" name="personnelReportType" value="night"> 🌙 Ночная смена</label>
            </div>
            <form id="personnelReportForm" class="hidden">
                <div id="personnelCategoryInputs"></div>
                <div class="action-buttons">
                    <button type="button" onclick="savePersonnelReport()">💾 Сохранить отчёт</button>
                    <button class="secondary" onclick="backToMain()">← Назад к выбору отчёта</button>
                </div>
            </form>
        </div>

        <div id="summarySection" class="section">
            <div class="section-logo-top">
                <img src="img/logo2.png" alt="Section Logo" class="section-logo-large">
            </div>
            <h2>📄 Общий свод по всем складам</h2>
            <div class="checkbox-group">
                <label><input type="checkbox" id="summaryDay" checked> ☀️ Дневные смены</label>
                <label><input type="checkbox" id="summaryNight"> 🌙 Ночные смены</label>
            </div>
            <div class="filter-section">
                <h4>👤 Фильтр по руководителю</h4>
                <select id="managerFilter" onchange="updateSummaryTable()">
                    <option value="">Все руководители</option>
                    <option value="Территория 1 Шутин Д.М.">Территория 1 Шутин Д.М.</option>
                    <option value="Территория 2 Любавкская М.И.">Территория 2 Любавкская М.И.</option>
                </select>
            </div>
            <div class="date-section">
                <h3>📅 Выберите дату для анализа</h3>
                <div class="calendar-controls">
                    <button class="secondary" onclick="prevPeriodSummary()">← Предыдущий</button>
                    <button class="secondary" onclick="toggleCalendarViewSummary()">
                        <span id="summaryViewToggleText">📆 Месяц</span>
                    </button>
                    <button class="secondary" onclick="nextPeriodSummary()">Следующий →</button>
                </div>
                <div id="summaryCalendar" class="calendar"></div>
            </div>
            <div class="action-buttons">
                <button onclick="showSummaryData()">📈 Показать сводные данные</button>
                <button class="secondary" onclick="backToMain()">← Назад к выбору отчёта</button>
            </div>
        </div>

        <div id="summaryTableSection" class="section">
            <h2>📋 Сводная таблица</h2>
            <div class="date-navigation">
                <div class="date-logo-center">
                    <img src="img/logo4.png" alt="Logo" class="date-navigation-logo">
                </div>
                <div class="date-controls-right">
                    <div class="date-display-small" id="currentSummaryDate"></div>
                    <div class="date-arrows-right">
                        <button class="date-arrow-btn" onclick="prevSummaryDay()">←</button>
                        <button class="date-arrow-btn" onclick="nextSummaryDay()">→</button>
                    </div>
                </div>
            </div>
            <div id="summaryTable"></div>
            <div class="action-buttons">
                <button onclick="toggleFullScreen()">🖥️ Полный экран</button>
                <button class="secondary" onclick="showSummarySection()">← Назад</button>
            </div>
        </div>

        <div id="personnelSummarySection" class="section">
            <div class="section-logo-top">
                <img src="img/logo2.png" alt="Personnel Logo" class="section-logo-large">
            </div>
            <h2>📄 Общий свод по персоналу</h2>
            <div class="checkbox-group">
                <label><input type="checkbox" id="personnelSummaryDay" checked> ☀️ Дневные смены</label>
                <label><input type="checkbox" id="personnelSummaryNight"> 🌙 Ночные смены</label>
            </div>
            <div class="filter-section">
                <h4>👤 Фильтр по руководителю</h4>
                <select id="personnelManagerFilter" onchange="updatePersonnelSummaryTable()">
                    <option value="">Все руководители</option>
                    <option value="Территория 1 Шутин Д.М.">Территория 1 Шутин Д.М.</option>
                    <option value="Территория 2 Любавкская М.И.">Территория 2 Любавкская М.И.</option>
                </select>
            </div>
            <div class="date-section">
                <h3>📅 Выберите дату для анализа</h3>
                <div class="calendar-controls">
                    <button class="secondary" onclick="prevPeriodPersonnelSummary()">← Предыдущий</button>
                    <button class="secondary" onclick="toggleCalendarViewPersonnelSummary()">
                        <span id="personnelSummaryViewToggleText">📆 Месяц</span>
                    </button>
                    <button class="secondary" onclick="nextPeriodPersonnelSummary()">Следующий →</button>
                </div>
                <div id="personnelSummaryCalendar" class="calendar"></div>
            </div>
            <div class="action-buttons">
                <button onclick="showPersonnelSummaryData()">📈 Показать сводные данные</button>
                <button class="secondary" onclick="backToMain()">← Назад к выбору отчёта</button>
            </div>
        </div>

        <div id="personnelSummaryTableSection" class="section">
            <h2>📋 Сводная таблица по персоналу</h2>
            <div class="date-navigation">
                <div class="date-logo-center">
                    <img src="img/logo4.png" alt="Logo" class="date-navigation-logo">
                </div>
                <div class="date-controls-right">
                    <div class="date-display-small" id="currentPersonnelSummaryDate"></div>
                    <div class="date-arrows-right">
                        <button class="date-arrow-btn" onclick="prevPersonnelSummaryDay()">←</button>
                        <button class="date-arrow-btn" onclick="nextPersonnelSummaryDay()">→</button>
                    </div>
                </div>
            </div>
            <div id="personnelSummaryTable"></div>
            <div class="action-buttons">
                <button onclick="togglePersonnelFullScreen()">🖥️ Полный экран</button>
                <button class="secondary" onclick="showPersonnelSummarySection()">← Назад</button>
            </div>
        </div>

        <div id="fullScreenTable" class="full-screen-table" style="display:none">
            <button class="close-full" onclick="toggleFullScreen()">✕ Закрыть</button>
            <div id="fullSummaryTable"></div>
        </div>

        <div id="fullPersonnelScreenTable" class="full-screen-table" style="display:none">
            <button class="close-full" onclick="togglePersonnelFullScreen()">✕ Закрыть</button>
            <div id="fullPersonnelSummaryTable"></div>
        </div>

        <div id="exportSection" class="section">
            <h2>📊 Экспорт Excel</h2>
            <div class="export-form">
                <div class="filter-section">
                    <h4>Параметры экспорта</h4>
                    <div class="category-input">
                        <label>Период:</label>
                        <div class="input-row">
                            <div>
                                <label for="exportDateFrom">С даты:</label>
                                <input type="date" id="exportDateFrom">
                            </div>
                            <div>
                                <label for="exportDateTo">По дату:</label>
                                <input type="date" id="exportDateTo">
                            </div>
                        </div>
                    </div>
                    
                    <div class="category-input">
                        <label for="exportShiftType">Тип смены:</label>
                        <select id="exportShiftType">
                            <option value="">Все смены</option>
                            <option value="day">Дневная</option>
                            <option value="night">Ночная</option>
                        </select>
                    </div>
                    
                    <div class="category-input">
                        <label for="exportManager">Руководитель:</label>
                        <select id="exportManager">
                            <option value="">Все руководители</option>
                            <option value="Территория 1 Шутин Д.М.">Территория 1 Шутин Д.М.</option>
                            <option value="Территория 2 Любавкская М.И.">Территория 2 Любавкская М.И.</option>
                        </select>
                    </div>
                    
                    <div class="category-input">
                        <label for="exportWarehouse">Склад:</label>
                        <select id="exportWarehouse">
                            <option value="">Все склады</option>
                        </select>
                    </div>
                    
                    <div class="category-input">
                        <label for="exportReportType">Тип отчета:</label>
                        <select id="exportReportType">
                            <option value="">Все отчеты</option>
                            <option value="operational">Операционные показатели</option>
                            <option value="personnel">Персонал</option>
                        </select>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="large-button" onclick="performExport()">📊 Экспортировать в Excel</button>
                    <button class="secondary" onclick="backToMain()">← Назад к выбору отчёта</button>
                </div>
            </div>
        </div>

        <div id="console-output"></div>
        
        <!-- Плашка с информацией о последнем обновлении -->
        <div id="updateBadge" class="update-badge">
            <span id="updateBadgeText">Последнее обновление функционала 06.11.2025 03:33:00</span>
        </div>
    </div>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- SheetJS для Excel экспорта -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/xlsx.full.min.js"></script>
    
    <!-- JavaScript Modules -->
    <script type="module" src="src/js/app.js"></script>
</body>
</html>
